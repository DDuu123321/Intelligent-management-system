import{d as se,r as c,b as re,c as de,Q as G,R as oe,a1 as ie,e as D,h as a,w as l,i as d,E as y,g as _,t as s,M as o,l as me,ae as pe,P as ue,a7 as ce,N as k,L as N,aa as H,ab as J,a9 as ve,o as v,_ as fe}from"./index-CC1QUR8I.js";import{r as C}from"./request-RQfx8Tvg.js";const _e=f=>C.get("/departments",{params:f}),be=f=>C.post("/departments",f),ge=(f,g)=>C.put(`/departments/${f}`,g),he=f=>C.delete(`/departments/${f}`),$e=(f,g)=>C.get(`/departments/${f}/employees`,{params:g}),ye={class:"departments-container"},we={class:"header-content"},Ve={class:"header-actions"},De={class:"card-header"},ke={class:"header-controls"},Ce={class:"department-name"},Fe={key:0},Ue={key:1,class:"text-muted"},Ee={key:0,class:"department-detail"},Be={class:"mt-4"},Se=se({__name:"Departments",setup(f){const g=c(!1),B=c(!1),h=c(!1),S=c(!1),z=c(!1),F=c([]),O=c([]),m=c(null),p=c(null),K=c([]),{t:i}=re(),U=c(),r=de({name:"",description:"",manager_id:void 0,parent_id:void 0,sort_order:0,is_active:!0}),W=G(()=>({name:[{required:!0,message:i("departments.form.validation.nameRequired"),trigger:"blur"},{min:2,max:50,message:i("departments.form.validation.nameLength"),trigger:"blur"}],sort_order:[{required:!0,message:i("departments.form.validation.sortOrderRequired"),trigger:"blur"}]})),X=G(()=>{if(!p.value)return F.value;const e=new Set([p.value.id]),n=w=>{w.children&&w.children.forEach(b=>{e.add(b.id),n(b)})};return n(p.value),F.value.filter(w=>!e.has(w.id))}),E=async()=>{g.value=!0;try{const e=await _e({include_inactive:z.value});F.value=e.data}catch{y.error(i("departments.messages.fetchFailed"))}finally{g.value=!1}},Y=async e=>{m.value=e;try{const n=await $e(e.id);O.value=n.data.employees}catch{y.error(i("departments.messages.fetchEmployeesFailed"))}S.value=!0},Z=e=>{p.value=e,Object.assign(r,{name:e.name,description:e.description,manager_id:e.manager_id,parent_id:e.parent_id,sort_order:e.sort_order,is_active:e.is_active}),h.value=!0},R=()=>{Object.assign(r,{name:"",description:"",manager_id:void 0,parent_id:void 0,sort_order:0,is_active:!0}),p.value=null,U.value?.resetFields()},x=async()=>{if(U.value)try{await U.value.validate(),B.value=!0,p.value?(await ge(p.value.id,r),y.success(i("departments.messages.updateSuccess"))):(await be(r),y.success(i("departments.messages.createSuccess"))),h.value=!1,R(),await E()}catch(e){e!==!1&&y.error(p.value?i("departments.messages.updateFailed"):i("departments.messages.createFailed"))}finally{B.value=!1}},ee=async e=>{try{await ve.confirm(i("departments.messages.deleteConfirm",{name:e.name}),i("departments.messages.deleteTitle"),{confirmButtonText:i("departments.delete"),cancelButtonText:i("departments.cancel"),type:"warning"}),await he(e.id),y.success(i("departments.messages.deleteSuccess")),await E()}catch(n){n!=="cancel"&&y.error(i("departments.messages.deleteFailed"))}};return oe(()=>{E()}),ie(h,e=>{e||R()}),(e,n)=>{const w=d("el-icon"),b=d("el-button"),q=d("el-card"),M=d("el-switch"),I=d("el-tag"),u=d("el-table-column"),T=d("el-table"),L=d("el-input"),V=d("el-form-item"),j=d("el-option"),P=d("el-select"),te=d("el-input-number"),ae=d("el-form"),Q=d("el-dialog"),$=d("el-descriptions-item"),le=d("el-descriptions"),ne=ce("loading");return v(),D("div",ye,[a(q,{class:"page-header"},{default:l(()=>[_("div",we,[_("h1",null,s(e.$t("departments.title")),1),_("div",Ve,[a(b,{type:"primary",onClick:n[0]||(n[0]=t=>h.value=!0)},{default:l(()=>[a(w,null,{default:l(()=>[a(me(pe))]),_:1}),o(" "+s(e.$t("departments.add")),1)]),_:1})])])]),_:1}),a(q,null,{header:l(()=>[_("div",De,[_("span",null,s(e.$t("departments.list")),1),_("div",ke,[a(M,{modelValue:z.value,"onUpdate:modelValue":n[1]||(n[1]=t=>z.value=t),onChange:E,"active-text":e.$t("departments.switches.showInactive"),"inactive-text":e.$t("departments.switches.hideInactive")},null,8,["modelValue","active-text","inactive-text"])])])]),default:l(()=>[ue((v(),k(T,{data:F.value,style:{width:"100%"},"row-key":"id","tree-props":{children:"children"}},{default:l(()=>[a(u,{prop:"name",label:e.$t("departments.name"),"min-width":"200"},{default:l(({row:t})=>[_("div",Ce,[_("span",null,s(t.name),1),t.is_active?N("",!0):(v(),k(I,{key:0,type:"info",size:"small"},{default:l(()=>[o(s(e.$t("departments.switches.disabled")),1)]),_:1}))])]),_:1},8,["label"]),a(u,{prop:"description",label:e.$t("departments.description"),"min-width":"200","show-overflow-tooltip":""},null,8,["label"]),a(u,{prop:"manager",label:e.$t("departments.manager"),"min-width":"120"},{default:l(({row:t})=>[t.manager?(v(),D("span",Fe,s(t.manager.first_name)+" "+s(t.manager.last_name),1)):(v(),D("span",Ue,s(e.$t("departments.details.notSet")),1))]),_:1},8,["label"]),a(u,{prop:"employee_count",label:e.$t("departments.employeeCount"),width:"100",align:"center"},{default:l(({row:t})=>[a(I,{type:"primary",size:"small"},{default:l(()=>[o(s(t.employee_count||0),1)]),_:2},1024)]),_:1},8,["label"]),a(u,{prop:"sort_order",label:e.$t("departments.sortOrder"),width:"80",align:"center"},null,8,["label"]),a(u,{label:e.$t("departments.actions"),width:"200",fixed:"right"},{default:l(({row:t})=>[a(b,{size:"small",onClick:A=>Y(t)},{default:l(()=>[o(s(e.$t("departments.view")),1)]),_:2},1032,["onClick"]),a(b,{size:"small",type:"primary",onClick:A=>Z(t)},{default:l(()=>[o(s(e.$t("departments.edit")),1)]),_:2},1032,["onClick"]),a(b,{size:"small",type:"danger",onClick:A=>ee(t),disabled:t.employee_count>0||t.children&&t.children.length>0},{default:l(()=>[o(s(e.$t("departments.delete")),1)]),_:2},1032,["onClick","disabled"])]),_:1},8,["label"])]),_:1},8,["data"])),[[ne,g.value]])]),_:1}),a(Q,{modelValue:h.value,"onUpdate:modelValue":n[9]||(n[9]=t=>h.value=t),title:p.value?e.$t("departments.edit"):e.$t("departments.create"),width:"600px"},{footer:l(()=>[a(b,{onClick:n[8]||(n[8]=t=>h.value=!1)},{default:l(()=>[o(s(e.$t("departments.cancel")),1)]),_:1}),a(b,{type:"primary",onClick:x,loading:B.value},{default:l(()=>[o(s(p.value?e.$t("departments.update"):e.$t("departments.create")),1)]),_:1},8,["loading"])]),default:l(()=>[a(ae,{ref_key:"departmentFormRef",ref:U,model:r,rules:W.value,"label-width":"100px"},{default:l(()=>[a(V,{label:e.$t("departments.form.name"),prop:"name"},{default:l(()=>[a(L,{modelValue:r.name,"onUpdate:modelValue":n[2]||(n[2]=t=>r.name=t),placeholder:e.$t("departments.form.placeholders.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(V,{label:e.$t("departments.form.description"),prop:"description"},{default:l(()=>[a(L,{modelValue:r.description,"onUpdate:modelValue":n[3]||(n[3]=t=>r.description=t),type:"textarea",rows:3,placeholder:e.$t("departments.form.placeholders.description")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(V,{label:e.$t("departments.form.parentDepartment"),prop:"parent_id"},{default:l(()=>[a(P,{modelValue:r.parent_id,"onUpdate:modelValue":n[4]||(n[4]=t=>r.parent_id=t),placeholder:e.$t("departments.form.placeholders.parentDepartment"),clearable:"",style:{width:"100%"}},{default:l(()=>[(v(!0),D(H,null,J(X.value,t=>(v(),k(j,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(V,{label:e.$t("departments.form.manager"),prop:"manager_id"},{default:l(()=>[a(P,{modelValue:r.manager_id,"onUpdate:modelValue":n[5]||(n[5]=t=>r.manager_id=t),placeholder:e.$t("departments.form.placeholders.manager"),clearable:"",filterable:"",style:{width:"100%"}},{default:l(()=>[(v(!0),D(H,null,J(K.value,t=>(v(),k(j,{key:t.id,label:`${t.first_name} ${t.last_name} (${t.employee_id})`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(V,{label:e.$t("departments.form.sortOrder"),prop:"sort_order"},{default:l(()=>[a(te,{modelValue:r.sort_order,"onUpdate:modelValue":n[6]||(n[6]=t=>r.sort_order=t),min:0,max:999,"controls-position":"right"},null,8,["modelValue"])]),_:1},8,["label"]),p.value?(v(),k(V,{key:0,label:e.$t("departments.form.status"),prop:"is_active"},{default:l(()=>[a(M,{modelValue:r.is_active,"onUpdate:modelValue":n[7]||(n[7]=t=>r.is_active=t),"active-text":e.$t("departments.form.active"),"inactive-text":e.$t("departments.form.inactive")},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])):N("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),a(Q,{modelValue:S.value,"onUpdate:modelValue":n[10]||(n[10]=t=>S.value=t),title:e.$t("departments.details.title"),width:"800px"},{default:l(()=>[m.value?(v(),D("div",Ee,[a(le,{column:2,border:""},{default:l(()=>[a($,{label:e.$t("departments.details.name")},{default:l(()=>[o(s(m.value.name),1)]),_:1},8,["label"]),a($,{label:e.$t("departments.details.status")},{default:l(()=>[a(I,{type:m.value.is_active?"success":"info"},{default:l(()=>[o(s(m.value.is_active?e.$t("departments.switches.enabled"):e.$t("departments.switches.disabled")),1)]),_:1},8,["type"])]),_:1},8,["label"]),a($,{label:e.$t("departments.details.parentDepartment")},{default:l(()=>[o(s(m.value.parent?.name||e.$t("departments.details.none")),1)]),_:1},8,["label"]),a($,{label:e.$t("departments.details.manager")},{default:l(()=>[o(s(m.value.manager?`${m.value.manager.first_name} ${m.value.manager.last_name}`:e.$t("departments.details.notSet")),1)]),_:1},8,["label"]),a($,{label:e.$t("departments.details.employeeCount")},{default:l(()=>[o(s(m.value.employee_count||0),1)]),_:1},8,["label"]),a($,{label:e.$t("departments.details.sortOrder")},{default:l(()=>[o(s(m.value.sort_order),1)]),_:1},8,["label"]),a($,{label:e.$t("departments.details.description"),span:2},{default:l(()=>[o(s(m.value.description||e.$t("departments.details.none")),1)]),_:1},8,["label"])]),_:1}),_("div",Be,[_("h3",null,s(e.$t("departments.details.employees")),1),a(T,{data:O.value,style:{width:"100%"},size:"small"},{default:l(()=>[a(u,{prop:"employee_id",label:e.$t("departments.details.employeeId"),width:"120"},null,8,["label"]),a(u,{label:e.$t("departments.details.employeeName"),width:"120"},{default:l(({row:t})=>[o(s(t.first_name)+" "+s(t.last_name),1)]),_:1},8,["label"]),a(u,{prop:"position",label:e.$t("departments.details.position")},null,8,["label"]),a(u,{prop:"phone",label:e.$t("departments.details.phone"),width:"130"},null,8,["label"]),a(u,{prop:"start_date",label:e.$t("departments.details.startDate"),width:"110"},null,8,["label"])]),_:1},8,["data"])])])):N("",!0)]),_:1},8,["modelValue","title"])])}}}),Ne=fe(Se,[["__scopeId","data-v-2eda95d9"]]);export{Ne as default};
