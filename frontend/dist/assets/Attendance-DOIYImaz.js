import{d as be,b as ge,r as u,c as q,Q as T,R as ye,e as ke,h as t,w as a,i as o,E as I,a8 as $e,g as n,t as c,M as g,P as we,a7 as Ce,N as Ve,a9 as Ie,o as X,_ as Se}from"./index-CC1QUR8I.js";import{i as G}from"./index-BfzQXryb.js";import{r as J}from"./request-RQfx8Tvg.js";const Oe=()=>J.get("/attendance/stats"),De=z=>J.get("/attendance/records",{params:z}),Ue={class:"attendance-container"},Te={class:"header-content"},ze={class:"header-actions"},Ae={class:"stat-content"},Be={class:"stat-icon present"},Re={class:"stat-info"},Ee={class:"stat-number"},Pe={class:"stat-label"},Fe={class:"stat-content"},Me={class:"stat-icon late"},Ne={class:"stat-info"},je={class:"stat-number"},He={class:"stat-label"},Le={class:"stat-content"},Qe={class:"stat-icon absent"},qe={class:"stat-info"},Xe={class:"stat-number"},Ge={class:"stat-label"},Je={class:"stat-content"},Ke={class:"stat-icon leave"},We={class:"stat-info"},Ye={class:"stat-number"},Ze={class:"stat-label"},xe={class:"card-header"},et={class:"header-controls"},tt={class:"pagination-container"},at={class:"dialog-footer"},lt=be({__name:"Attendance",setup(z){const{t:d}=ge(),A=u(!1),O=u(!1),h=u([]),_=u(""),f=u("all"),v=u(1),D=u(10),B=u(0),y=u(!1),R=u(),E=u(),k=q({present:0,late:0,absent:0,leave:0}),P=u([]),r=q({id:"",name:"",date:"",checkIn:"",checkOut:"",status:"present"}),K=T(()=>P.value.map(e=>({id:e.id,employeeId:e.User?.employee_id||"",name:e.User?.name||"",department:e.User?.department||"",date:e.date,checkIn:e.check_in||"-",checkOut:e.check_out||"-",workHours:e.work_hours?`${e.work_hours}${d("units.hour")}`:"-",status:e.status}))),F=T(()=>{let e=K.value;return _.value&&(e=e.filter(l=>l.name.includes(_.value)||l.employeeId.includes(_.value))),f.value!=="all"&&(e=e.filter(l=>l.status===f.value)),e});T(()=>F.value.length);const W=e=>({present:"success",late:"warning",absent:"danger",leave:"info"})[e]??"info",Y=e=>({present:d("status.present"),late:d("status.late"),absent:d("status.absent"),leave:d("status.leave")})[e]||d("common.unknown"),Z=e=>{console.log("日期范围变更:",e),v.value=1,$()},M=()=>{v.value=1,$()},x=e=>{v.value=e,$()},ee=e=>{D.value=e,v.value=1,$()},te=e=>{Object.assign(r,e),y.value=!0},ae=()=>{I.success(d("attendance.saveSuccess")),y.value=!1},le=e=>{Ie.confirm(d("attendance.deleteConfirmMessage"),d("attendance.deleteConfirmTitle"),{confirmButtonText:d("common.confirm"),cancelButtonText:d("common.cancel"),type:"warning"}).then(()=>{I.success(d("attendance.deleteSuccess"))})},ne=()=>{I.success(d("attendance.exportProcessing"))},se=async()=>{try{A.value=!0;const e=await Oe();e.success&&Object.assign(k,e.data)}catch(e){console.error("获取考勤统计失败:",e),I.error("获取考勤统计失败")}finally{A.value=!1}},$=async()=>{try{O.value=!0;const e={page:v.value,limit:D.value,search:_.value,status:f.value!=="all"?f.value:void 0,startDate:h.value?.[0]?N(h.value[0]):void 0,endDate:h.value?.[1]?N(h.value[1]):void 0},l=await De(e);l.success&&(P.value=l.data.records,B.value=l.data.pagination.total)}catch(e){console.error("获取考勤记录失败:",e),I.error("获取考勤记录失败")}finally{O.value=!1}},N=e=>e.toISOString().split("T")[0],oe=()=>{$e(()=>{const e=G(R.value),l={tooltip:{trigger:"axis"},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"]},yAxis:{type:"value"},series:[{name:d("attendance.seriesAttendance"),type:"line",data:[180,175,182,178,185,90,45],smooth:!0,itemStyle:{color:"#409EFF"}}]};e.setOption(l);const S=G(E.value),U={tooltip:{trigger:"item"},series:[{name:d("attendance.pieTitle"),type:"pie",radius:"60%",data:[{value:45,name:d("attendance.departments.tech")},{value:35,name:d("attendance.departments.sales")},{value:25,name:d("attendance.departments.hr")},{value:20,name:d("attendance.departments.finance")},{value:15,name:d("attendance.departments.operations")}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};S.setOption(U)})};return ye(()=>{oe(),se(),$()}),(e,l)=>{const S=o("el-date-picker"),U=o("Download"),w=o("el-icon"),C=o("el-button"),m=o("el-card"),de=o("Check"),b=o("el-col"),ce=o("Clock"),re=o("Close"),ue=o("Calendar"),j=o("el-row"),H=o("el-input"),i=o("el-option"),L=o("el-select"),p=o("el-table-column"),ie=o("el-tag"),pe=o("el-table"),me=o("el-pagination"),V=o("el-form-item"),Q=o("el-time-picker"),ve=o("el-form"),he=o("el-dialog"),_e=Ce("loading");return X(),ke("div",Ue,[t(m,{class:"page-header"},{default:a(()=>[n("div",Te,[n("h1",null,c(e.$t("attendance.title")),1),n("div",ze,[t(S,{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=s=>h.value=s),type:"daterange","range-separator":e.$t("attendance.to"),"start-placeholder":e.$t("attendance.startDate"),"end-placeholder":e.$t("attendance.endDate"),onChange:Z},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"]),t(C,{type:"primary",onClick:ne},{default:a(()=>[t(w,null,{default:a(()=>[t(U)]),_:1}),g(" "+c(e.$t("common.export")),1)]),_:1})])])]),_:1}),t(j,{gutter:20,class:"stats-section"},{default:a(()=>[t(b,{span:6},{default:a(()=>[t(m,{class:"stat-card"},{default:a(()=>[n("div",Ae,[n("div",Be,[t(w,null,{default:a(()=>[t(de)]),_:1})]),n("div",Re,[n("div",Ee,c(k.present),1),n("div",Pe,c(e.$t("status.present")),1)])])]),_:1})]),_:1}),t(b,{span:6},{default:a(()=>[t(m,{class:"stat-card"},{default:a(()=>[n("div",Fe,[n("div",Me,[t(w,null,{default:a(()=>[t(ce)]),_:1})]),n("div",Ne,[n("div",je,c(k.late),1),n("div",He,c(e.$t("status.late")),1)])])]),_:1})]),_:1}),t(b,{span:6},{default:a(()=>[t(m,{class:"stat-card"},{default:a(()=>[n("div",Le,[n("div",Qe,[t(w,null,{default:a(()=>[t(re)]),_:1})]),n("div",qe,[n("div",Xe,c(k.absent),1),n("div",Ge,c(e.$t("status.absent")),1)])])]),_:1})]),_:1}),t(b,{span:6},{default:a(()=>[t(m,{class:"stat-card"},{default:a(()=>[n("div",Je,[n("div",Ke,[t(w,null,{default:a(()=>[t(ue)]),_:1})]),n("div",We,[n("div",Ye,c(k.leave),1),n("div",Ze,c(e.$t("status.leave")),1)])])]),_:1})]),_:1})]),_:1}),t(j,{gutter:20,class:"main-content"},{default:a(()=>[t(b,{span:16},{default:a(()=>[t(m,null,{header:a(()=>[n("div",xe,[n("span",null,c(e.$t("attendance.recordList")),1),n("div",et,[t(H,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=s=>_.value=s),placeholder:e.$t("attendance.searchPlaceholder"),"prefix-icon":"Search",style:{width:"200px"},onInput:M},null,8,["modelValue","placeholder"]),t(L,{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=s=>f.value=s),placeholder:e.$t("attendance.statusFilter"),style:{width:"140px","margin-left":"10px"},onChange:M},{default:a(()=>[t(i,{label:e.$t("attendance.all"),value:"all"},null,8,["label"]),t(i,{label:e.$t("status.present"),value:"present"},null,8,["label"]),t(i,{label:e.$t("status.late"),value:"late"},null,8,["label"]),t(i,{label:e.$t("status.absent"),value:"absent"},null,8,["label"]),t(i,{label:e.$t("status.leave"),value:"leave"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])])])]),default:a(()=>[we((X(),Ve(pe,{data:F.value,style:{width:"100%"}},{default:a(()=>[t(p,{prop:"employeeId",label:e.$t("attendance.employeeId"),width:"80"},null,8,["label"]),t(p,{prop:"name",label:e.$t("attendance.name"),width:"100"},null,8,["label"]),t(p,{prop:"department",label:e.$t("attendance.department"),width:"120"},null,8,["label"]),t(p,{prop:"date",label:e.$t("attendance.date"),width:"100"},null,8,["label"]),t(p,{prop:"checkIn",label:e.$t("attendance.checkIn"),width:"100"},null,8,["label"]),t(p,{prop:"checkOut",label:e.$t("attendance.checkOut"),width:"100"},null,8,["label"]),t(p,{prop:"workHours",label:e.$t("attendance.workHours"),width:"100"},null,8,["label"]),t(p,{prop:"status",label:e.$t("common.status"),width:"80"},{default:a(s=>[t(ie,{type:W(s.row.status),size:"small"},{default:a(()=>[g(c(Y(s.row.status)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),t(p,{label:e.$t("common.operation"),width:"140"},{default:a(s=>[t(C,{link:"",type:"primary",size:"small",onClick:fe=>te(s.row)},{default:a(()=>[g(c(e.$t("common.edit")),1)]),_:2},1032,["onClick"]),t(C,{link:"",type:"danger",size:"small",onClick:fe=>le(s.row)},{default:a(()=>[g(c(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[_e,O.value]]),n("div",tt,[t(me,{"current-page":v.value,"onUpdate:currentPage":l[3]||(l[3]=s=>v.value=s),"page-size":D.value,total:B.value,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],onCurrentChange:x,onSizeChange:ee},null,8,["current-page","page-size","total"])])]),_:1})]),_:1}),t(b,{span:8},{default:a(()=>[t(m,{style:{"margin-bottom":"20px"}},{header:a(()=>[n("span",null,c(e.$t("attendance.weekTrend")),1)]),default:a(()=>[n("div",{ref_key:"weeklyChart",ref:R,style:{height:"200px"}},null,512)]),_:1}),t(m,null,{header:a(()=>[n("span",null,c(e.$t("attendance.deptStats")),1)]),default:a(()=>[n("div",{ref_key:"departmentChart",ref:E,style:{height:"200px"}},null,512)]),_:1})]),_:1})]),_:1}),t(he,{modelValue:y.value,"onUpdate:modelValue":l[10]||(l[10]=s=>y.value=s),title:e.$t("attendance.editTitle"),width:"500px"},{footer:a(()=>[n("span",at,[t(C,{onClick:l[9]||(l[9]=s=>y.value=!1)},{default:a(()=>[g(c(e.$t("common.cancel")),1)]),_:1}),t(C,{type:"primary",onClick:ae},{default:a(()=>[g(c(e.$t("common.save")),1)]),_:1})])]),default:a(()=>[t(ve,{model:r,"label-width":"100px"},{default:a(()=>[t(V,{label:e.$t("attendance.employeeName")},{default:a(()=>[t(H,{modelValue:r.name,"onUpdate:modelValue":l[4]||(l[4]=s=>r.name=s),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),t(V,{label:e.$t("attendance.date")},{default:a(()=>[t(S,{modelValue:r.date,"onUpdate:modelValue":l[5]||(l[5]=s=>r.date=s),type:"date",placeholder:e.$t("attendance.date"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(V,{label:e.$t("attendance.checkIn")},{default:a(()=>[t(Q,{modelValue:r.checkIn,"onUpdate:modelValue":l[6]||(l[6]=s=>r.checkIn=s),placeholder:e.$t("attendance.checkIn"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(V,{label:e.$t("attendance.checkOut")},{default:a(()=>[t(Q,{modelValue:r.checkOut,"onUpdate:modelValue":l[7]||(l[7]=s=>r.checkOut=s),placeholder:e.$t("attendance.checkOut"),style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(V,{label:e.$t("common.status")},{default:a(()=>[t(L,{modelValue:r.status,"onUpdate:modelValue":l[8]||(l[8]=s=>r.status=s),style:{width:"100%"}},{default:a(()=>[t(i,{label:e.$t("status.present"),value:"present"},null,8,["label"]),t(i,{label:e.$t("status.late"),value:"late"},null,8,["label"]),t(i,{label:e.$t("status.absent"),value:"absent"},null,8,["label"]),t(i,{label:e.$t("status.leave"),value:"leave"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),dt=Se(lt,[["__scopeId","data-v-44edf8fb"]]);export{dt as default};
