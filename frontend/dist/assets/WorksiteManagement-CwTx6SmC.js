import{d as ie,r as m,c as de,Q as ue,R as me,e as y,g as I,P as pe,h as e,t as n,w as a,i,a7 as ce,N as _e,E as h,M as r,l as H,ae as ge,af as fe,L as ve,a9 as be,o as k,_ as we}from"./index-CC1QUR8I.js";import{r as D}from"./request-RQfx8Tvg.js";const ke={class:"worksite-management"},$e={class:"page-header"},Ve={class:"filter-section"},ye={key:0},he={key:1,class:"text-gray"},Ce={key:0,class:"worksite-details"},ze={key:0},Ue={key:1},De=ie({__name:"WorksiteManagement",setup(Te){const T=m(!1),S=m(!1),M=m([]),j=m(0),W=m(1),A=m(10),C=m(""),z=m(""),$=m(!1),E=m(!1),d=m(null),V=m(!1),o=de({worksite_id:"",name:"",address:"",latitude:null,longitude:null,status:"active",description:"",timezone:"Australia/Perth",manager_name:"",manager_phone:""}),J={worksite_id:[{required:!0,message:"请输入工地ID",trigger:"blur"}],name:[{required:!0,message:"请输入工地名称",trigger:"blur"}],address:[{required:!0,message:"请输入地址",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},P=m(),K=ue(()=>V.value?"编辑工地":"添加工地"),_=async()=>{T.value=!0;try{const t={page:W.value,limit:A.value,search:C.value,status:z.value},l=await D.get("/worksites",{params:t});if(l.success){const p=l.data.worksites||l.data;M.value=p.map(u=>({...u,address:u.street_address,latitude:u.center_latitude,longitude:u.center_longitude})),j.value=l.data.pagination?.total||0}else h.error(l.message||"加载工地数据失败")}catch(t){h.error("加载工地数据失败"),console.error("Error loading worksites:",t)}finally{T.value=!1}},X=()=>{te(),V.value=!1,$.value=!0},Y=t=>{Object.assign(o,{worksite_id:t.worksite_id,name:t.name,address:t.street_address,latitude:t.center_latitude,longitude:t.center_longitude,status:t.status,description:t.description,timezone:t.timezone,manager_name:t.project_manager,manager_phone:t.project_manager_phone}),V.value=!0,$.value=!0},Z=t=>{d.value=t,E.value=!0},x=async()=>{P.value&&await P.value.validate(async t=>{if(t){S.value=!0;try{if(V.value){const l={worksite_id:o.worksite_id,name:o.name,description:o.description,center_latitude:o.latitude,center_longitude:o.longitude,street_address:o.address,suburb:"Perth",state:"WA",postcode:"6000",status:o.status,start_date:new Date().toISOString().split("T")[0],timezone:o.timezone,project_manager:o.manager_name,project_manager_phone:o.manager_phone},p=await D.put(`/worksites/${o.worksite_id}`,l);if(!p.success)throw new Error(p.message)}else{const l={worksite_id:o.worksite_id,name:o.name,description:o.description,center_latitude:o.latitude,center_longitude:o.longitude,street_address:o.address,suburb:"Perth",state:"WA",postcode:"6000",status:o.status,start_date:new Date().toISOString().split("T")[0],timezone:o.timezone,project_manager:o.manager_name,project_manager_phone:o.manager_phone},p=await D.post("/worksites",l);if(!p.success)throw new Error(p.message)}h.success(V.value?"工地信息更新成功":"工地添加成功"),$.value=!1,_()}catch(l){h.error("保存失败: "+l.message),console.error("Error saving worksite:",l)}finally{S.value=!1}}})},ee=async t=>{try{await be.confirm("确定要删除这个工地吗？相关的二维码也会受到影响。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=await D.delete(`/worksites/${t.worksite_id}`);if(!l.success)throw new Error(l.message);h.success("工地删除成功"),_()}catch(l){l!=="cancel"&&(h.error("删除失败: "+(l.message||l)),console.error("Error deleting worksite:",l))}},te=()=>{Object.assign(o,{worksite_id:"",name:"",address:"",latitude:null,longitude:null,status:"active",description:"",timezone:"Australia/Perth",manager_name:"",manager_phone:""})},ae=()=>{C.value="",z.value="",_()},B=t=>new Date(t).toLocaleString(),q=t=>({active:"success",inactive:"info",suspended:"danger"})[t]||"info",N=t=>({active:"活跃",inactive:"非活跃",suspended:"暂停"})[t]||t;return me(()=>{_()}),(t,l)=>{const p=i("el-icon"),u=i("el-button"),b=i("el-input"),g=i("el-col"),f=i("el-option"),F=i("el-select"),U=i("el-row"),w=i("el-table-column"),O=i("el-tag"),le=i("el-table"),se=i("el-pagination"),c=i("el-form-item"),R=i("el-divider"),L=i("el-input-number"),oe=i("el-form"),Q=i("el-dialog"),v=i("el-descriptions-item"),ne=i("el-descriptions"),re=ce("loading");return k(),y("div",ke,[I("div",$e,[I("h2",null,n(t.$t("worksite.management")||"工地管理"),1),e(u,{type:"primary",onClick:X},{default:a(()=>[e(p,null,{default:a(()=>[e(H(ge))]),_:1}),r(" "+n(t.$t("worksite.add")||"添加工地"),1)]),_:1})]),I("div",Ve,[e(U,{gutter:20},{default:a(()=>[e(g,{span:8},{default:a(()=>[e(b,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=s=>C.value=s),placeholder:t.$t("worksite.searchPlaceholder")||"搜索工地名称或ID",clearable:"",onChange:_},{prefix:a(()=>[e(p,null,{default:a(()=>[e(H(fe))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),e(g,{span:4},{default:a(()=>[e(F,{modelValue:z.value,"onUpdate:modelValue":l[1]||(l[1]=s=>z.value=s),placeholder:t.$t("worksite.status")||"状态",clearable:"",onChange:_},{default:a(()=>[e(f,{label:t.$t("status.active")||"活跃",value:"active"},null,8,["label"]),e(f,{label:t.$t("status.inactive")||"非活跃",value:"inactive"},null,8,["label"]),e(f,{label:t.$t("status.suspended")||"暂停",value:"suspended"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1}),e(g,{span:4},{default:a(()=>[e(u,{onClick:ae},{default:a(()=>[r(n(t.$t("common.reset")||"重置"),1)]),_:1}),e(u,{type:"primary",onClick:_},{default:a(()=>[r(n(t.$t("common.search")||"搜索"),1)]),_:1})]),_:1})]),_:1})]),pe((k(),_e(le,{data:M.value,style:{width:"100%"}},{default:a(()=>[e(w,{prop:"worksite_id",label:t.$t("worksite.id")||"工地ID",width:"120"},null,8,["label"]),e(w,{prop:"name",label:t.$t("worksite.name")||"工地名称",width:"200"},null,8,["label"]),e(w,{prop:"address",label:t.$t("worksite.address")||"地址"},null,8,["label"]),e(w,{label:t.$t("worksite.coordinates")||"坐标",width:"180"},{default:a(({row:s})=>[s.latitude&&s.longitude?(k(),y("span",ye,n(s.latitude.toFixed(6))+", "+n(s.longitude.toFixed(6)),1)):(k(),y("span",he,"未设置"))]),_:1},8,["label"]),e(w,{prop:"status",label:t.$t("worksite.status")||"状态",width:"100"},{default:a(({row:s})=>[e(O,{type:q(s.status)},{default:a(()=>[r(n(N(s.status)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),e(w,{prop:"created_at",label:t.$t("common.createTime")||"创建时间",width:"160"},{default:a(({row:s})=>[r(n(B(s.created_at)),1)]),_:1},8,["label"]),e(w,{label:t.$t("common.actions")||"操作",width:"200",fixed:"right"},{default:a(({row:s})=>[e(u,{size:"small",onClick:G=>Z(s)},{default:a(()=>[r(n(t.$t("common.view")||"查看"),1)]),_:2},1032,["onClick"]),e(u,{size:"small",type:"primary",onClick:G=>Y(s)},{default:a(()=>[r(n(t.$t("common.edit")||"编辑"),1)]),_:2},1032,["onClick"]),e(u,{size:"small",type:"danger",onClick:G=>ee(s)},{default:a(()=>[r(n(t.$t("common.delete")||"删除"),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[re,T.value]]),e(se,{"current-page":W.value,"onUpdate:currentPage":l[2]||(l[2]=s=>W.value=s),"page-size":A.value,"onUpdate:pageSize":l[3]||(l[3]=s=>A.value=s),"page-sizes":[10,20,50,100],total:j.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_,onCurrentChange:_,style:{"margin-top":"20px","text-align":"center"}},null,8,["current-page","page-size","total"]),e(Q,{title:K.value,modelValue:$.value,"onUpdate:modelValue":l[15]||(l[15]=s=>$.value=s),width:"700px","close-on-click-modal":!1},{footer:a(()=>[e(u,{onClick:l[14]||(l[14]=s=>$.value=!1)},{default:a(()=>[r(n(t.$t("common.cancel")||"取消"),1)]),_:1}),e(u,{type:"primary",onClick:x,loading:S.value},{default:a(()=>[r(n(t.$t("common.save")||"保存"),1)]),_:1},8,["loading"])]),default:a(()=>[e(oe,{ref_key:"worksiteFormRef",ref:P,model:o,rules:J,"label-width":"120px"},{default:a(()=>[e(U,{gutter:20},{default:a(()=>[e(g,{span:12},{default:a(()=>[e(c,{label:t.$t("worksite.id")||"工地ID",prop:"worksite_id"},{default:a(()=>[e(b,{modelValue:o.worksite_id,"onUpdate:modelValue":l[4]||(l[4]=s=>o.worksite_id=s),disabled:V.value},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1}),e(g,{span:12},{default:a(()=>[e(c,{label:t.$t("worksite.status")||"状态",prop:"status"},{default:a(()=>[e(F,{modelValue:o.status,"onUpdate:modelValue":l[5]||(l[5]=s=>o.status=s),style:{width:"100%"}},{default:a(()=>[e(f,{label:t.$t("status.active")||"活跃",value:"active"},null,8,["label"]),e(f,{label:t.$t("status.inactive")||"非活跃",value:"inactive"},null,8,["label"]),e(f,{label:t.$t("status.suspended")||"暂停",value:"suspended"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(c,{label:t.$t("worksite.name")||"工地名称",prop:"name"},{default:a(()=>[e(b,{modelValue:o.name,"onUpdate:modelValue":l[6]||(l[6]=s=>o.name=s)},null,8,["modelValue"])]),_:1},8,["label"]),e(c,{label:t.$t("worksite.address")||"地址",prop:"address"},{default:a(()=>[e(b,{modelValue:o.address,"onUpdate:modelValue":l[7]||(l[7]=s=>o.address=s),type:"textarea",rows:2},null,8,["modelValue"])]),_:1},8,["label"]),e(c,{label:t.$t("worksite.description")||"描述"},{default:a(()=>[e(b,{modelValue:o.description,"onUpdate:modelValue":l[8]||(l[8]=s=>o.description=s),type:"textarea",rows:3},null,8,["modelValue"])]),_:1},8,["label"]),e(R,null,{default:a(()=>[r(n(t.$t("worksite.locationInfo")||"位置信息"),1)]),_:1}),e(U,{gutter:20},{default:a(()=>[e(g,{span:12},{default:a(()=>[e(c,{label:t.$t("worksite.latitude")||"纬度",prop:"latitude"},{default:a(()=>[e(L,{modelValue:o.latitude,"onUpdate:modelValue":l[9]||(l[9]=s=>o.latitude=s),precision:8,step:1e-5,style:{width:"100%"},placeholder:t.$t("worksite.latitudePlaceholder")||"例: -31.9505"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(g,{span:12},{default:a(()=>[e(c,{label:t.$t("worksite.longitude")||"经度",prop:"longitude"},{default:a(()=>[e(L,{modelValue:o.longitude,"onUpdate:modelValue":l[10]||(l[10]=s=>o.longitude=s),precision:8,step:1e-5,style:{width:"100%"},placeholder:t.$t("worksite.longitudePlaceholder")||"例: 115.8605"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),e(c,{label:t.$t("worksite.timezone")||"时区"},{default:a(()=>[e(F,{modelValue:o.timezone,"onUpdate:modelValue":l[11]||(l[11]=s=>o.timezone=s),style:{width:"100%"}},{default:a(()=>[e(f,{label:"澳洲西部时间 (AWST UTC+8)",value:"Australia/Perth"}),e(f,{label:"澳洲东部时间 (AEST UTC+10)",value:"Australia/Sydney"}),e(f,{label:"澳洲中部时间 (ACST UTC+9:30)",value:"Australia/Adelaide"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(R,null,{default:a(()=>[r(n(t.$t("worksite.contactInfo")||"联系信息"),1)]),_:1}),e(U,{gutter:20},{default:a(()=>[e(g,{span:12},{default:a(()=>[e(c,{label:t.$t("worksite.manager")||"项目经理"},{default:a(()=>[e(b,{modelValue:o.manager_name,"onUpdate:modelValue":l[12]||(l[12]=s=>o.manager_name=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(g,{span:12},{default:a(()=>[e(c,{label:t.$t("worksite.phone")||"联系电话"},{default:a(()=>[e(b,{modelValue:o.manager_phone,"onUpdate:modelValue":l[13]||(l[13]=s=>o.manager_phone=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(Q,{title:t.$t("worksite.details")||"工地详情",modelValue:E.value,"onUpdate:modelValue":l[16]||(l[16]=s=>E.value=s),width:"600px"},{default:a(()=>[d.value?(k(),y("div",Ce,[e(ne,{column:2,border:""},{default:a(()=>[e(v,{label:t.$t("worksite.id")||"工地ID"},{default:a(()=>[r(n(d.value.worksite_id),1)]),_:1},8,["label"]),e(v,{label:t.$t("worksite.name")||"工地名称"},{default:a(()=>[r(n(d.value.name),1)]),_:1},8,["label"]),e(v,{label:t.$t("worksite.address")||"地址",span:"2"},{default:a(()=>[r(n(d.value.address||"未设置"),1)]),_:1},8,["label"]),e(v,{label:t.$t("worksite.coordinates")||"坐标"},{default:a(()=>[d.value.latitude&&d.value.longitude?(k(),y("span",ze,n(d.value.latitude.toFixed(6))+", "+n(d.value.longitude.toFixed(6)),1)):(k(),y("span",Ue,"未设置"))]),_:1},8,["label"]),e(v,{label:t.$t("worksite.status")||"状态"},{default:a(()=>[e(O,{type:q(d.value.status)},{default:a(()=>[r(n(N(d.value.status)),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(v,{label:t.$t("worksite.manager")||"项目经理"},{default:a(()=>[r(n(d.value.manager_name||"未设置"),1)]),_:1},8,["label"]),e(v,{label:t.$t("worksite.phone")||"联系电话"},{default:a(()=>[r(n(d.value.manager_phone||"未设置"),1)]),_:1},8,["label"]),e(v,{label:t.$t("worksite.description")||"描述",span:"2"},{default:a(()=>[r(n(d.value.description||"无描述"),1)]),_:1},8,["label"]),e(v,{label:t.$t("common.createTime")||"创建时间",span:"2"},{default:a(()=>[r(n(B(d.value.created_at)),1)]),_:1},8,["label"])]),_:1})])):ve("",!0)]),_:1},8,["title","modelValue"])])}}}),Ae=we(De,[["__scopeId","data-v-3984cf2d"]]);export{Ae as default};
